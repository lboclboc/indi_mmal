i420 = 0

saturation 0
sharpness 0
icontrast 0
ibrightness 50/100
iso 0
stabilization 0
exposure_comp 0
exposure mode 1 (auto)
flicker avoid 0 (off)
exposure metering 0 (average)
awb_mode 1 (auto)
image fw 0 (none)
color fx enable=0, u=128, v=128
rotation 0
flip hflip vflip = 0
ROI 0, 0, 65536, 65536
shutter 0
drc 0 (off)
capture stats pass 0
annotate enable =0
gains a=0 d=0
focus window 0

mmal_component_create camera

mmal_port_enable( control, cb)

preview format
    encoding MMAL_ENCODING_OPAQUE, variant = MMAL_ENCODING_I420
    format->es->video 1024x768 (+crop same)
    framerate 0/1
    par 0/0
    bitrate 0

mmal_port_format_commit(preview);

mmal_format_full_copy(video_port->format, format);

format = stillport->format

format_commit still

camera enable


raspiyuv:

open camera

enable port control

camera_config:
    stills_yuv422 = 0
    one_shot_stils = 1
    size 4056 x 3040
    preview 1024 x 768
    preview video frames 3
mmal_port_parameter_set(camera->control, &cam_config.hdr);

preview format:
   format->encoding = MMAL_ENCODING_OPAQUE;
   format->encoding_variant = MMAL_ENCODING_I420;

sätter även frame ranges för preview-porten.

preview format:
   size 1024x768
   OPAQ / I420
   framerate 0/1
   par 0/0
mmal_port_format_commit(preview_port)


copy format to video port
mmal_port_format_commit(video_port)

format = still->format
set frame ranges
format: 
    utan "-rgb"
      format->encoding = MMAL_ENCODING_I420;
      format->encoding_variant = MMAL_ENCODING_I420;

status = mmal_port_parameter_set_boolean(video_port, MMAL_PARAMETER_ZERO_COPY, MMAL_TRUE);
status = mmal_port_format_commit(still_port);

mmal_component_enable camera

create pool

kopplar ihop preview output till preview component input som är sink

semafor

mmal_port_enable(still)

mmal_port_parameter_set_uint32(state.camera_component->control, MMAL_PARAMETER_SHUTTER_SPEED, state.camera_parameters.shutter_speed

CAPTURE



Med -rgb

Encoding RGB3

if (!mmal_util_rgb_order_fixed(still_port)) ???
returns 1 if MMAL_ENCODING_RGB24 is returned first (and it does)
